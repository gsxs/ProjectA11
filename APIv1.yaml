swagger: '2.0'
info:
  version: '1.0'
  title: Project A11 RESTful API
host: localhost:8888
basePath: /api/v1
tags:
  - name: credential
  - name: user
  - name: class
  - name: course
  - name: score
  - name: check-in
  - name: misc
schemes:
  - http

paths:
  /credential/account:
    put:
      tags:
        - credential
      summary: to register
      description: register a new user
      operationId: account_register
      parameters:
        - in: body
          name: body
          required: true
          schema:
            $ref: '#/definitions/user-register'
      responses:
        '200':
          description: OK
    post:
      tags:
        - credential
      summary: to login
      operationId: account_login
      parameters:
        - in: body
          name: body
          required: true
          schema:
            type: object
            properties:
              user_id:
                type: string
                example: 12345678
              password:
                type: string
                example: p@ssword
      responses:
        '200':
          description: OK
          schema:
            type: object
            properties:
              session_id:
                type: string
                example: 7I+OyQhMCaMTpdU7W1VZ+0PFETZbaTTPU/UfW3nf0c/vDNj1oewNF3Z+tms0nwbK
    delete:
      tags:
        - credential
      summary: to logout
      description: clear the session of the logged user, remember to clear the local `session_id`
      operationId: account_logout
      parameters:
        - in: query
          name: session_id
          required: true
          type: string
      responses:
        '200':
          description: OK

  /user:
    get:
      tags:
        - user
      summary: to fetch the basic info of current logged user
      operationId: user_fetch
      parameters:
        - in: query
          name: session_id
          required: true
          type: string
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/user-show'

  /user/{user_id}:
    get:
      tags:
        - user
      summary: to fetch the basic info of the specific user
      operationId: user_fetch_specific
      parameters:
        - in: path
          name: user_id
          required: true
          type: integer
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/user-show'

    delete:
      tags:
        - user
      summary: to delete a user
      operationId: delete_users
      parameters:
        - in: query
          name: session_id
          required: true
          type: string
        - in: path
          name: user_id
          required: true
          type: integer
      responses:
        '200':
          description: OK

  '/class/{class_id}':
    get:
      tags:
        - class
      summary: to fetch the info of the specific class
      operationId: class_fetch_specific
      parameters:
        - in: path
          name: class_id
          required: true
          type: integer
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/class'

  '/course/{course_id}':
    get:
      tags:
        - course
      summary: to fetch the info of the specific course
      operationId: course_fetch_specific
      parameters:
        - in: path
          name: course_id
          required: true
          type: integer
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/course'

  '/user/{user_id}/score/{course_id}':
    get:
      tags:
        - user
        - score
      summary: to fetch the scores of the specific user
      operationId: score_fetch_specific
      parameters:
        - in: query
          name: session_id
          required: true
          type: string
        - in: path
          name: user_id
          required: true
          type: string
        - in: path
          name: course_id
          required: true
          type: integer
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/score'

  /score/{score_id}:
    post:
      tags:
        - score
      summary: to update the specific score item
      operationId: update_specific_score
      parameters:
        - in: query
          name: session_id
          required: true
          type: string
        - in: path
          name: score_id
          required: true
          type: integer
        - in: body
          name: body
          required: true
          schema:
            $ref: '#/definitions/score'
      responses:
        '200':
          description: OK

  /scores:
    put:
      tags:
        - score
      summary: to add some new scores
      operationId: add_new_score
      parameters:
        - in: query
          name: session_id
          required: true
          type: string
        - in: body
          name: body
          required: true
          schema:
            type: array
            items:
              $ref: '#/definitions/score-add'
      responses:
        '200':
          description: OK

  /class/{class_id}/scores:
    put:
      tags:
        - score
        - class
      summary: to add some new scores of a specific class
      operationId: add_new_score_specific_class
      parameters:
        - in: query
          name: session_id
          required: true
          type: string
        - in: path
          name: class_id
          required: true
          type: integer
        - in: body
          name: body
          required: true
          schema:
            type: array
            items:
              $ref: '#/definitions/score-add-specific-class'
      responses:
        '200':
          description: OK

  /user/{user_id}/classes:
    get:
      tags:
        - user
        - class
      summary: to fetch the classes which the current user belongs to
      operationId: user_classes_fetch
      parameters:
        - in: query
          name: session_id
          required: true
          type: string
        - in: path
          name: user_id
          required: true
          type: integer
      responses:
        '200':
          description: OK
          schema:
            type: array
            items:
              $ref: '#/definitions/class'

  /misc/captcha:
    get:
      tags:
        - misc
      summary: to fetch a captcha image
      operationId: captcha_fetch
      parameters:
        - in: query
          name: session_id
          required: true
          type: string
      responses:
        '200':
          description: OK
          schema:
            type: file
            example: (the binary data of the captcha image)

  /check-in/class/{class_id}/code:
    get:
      tags:
        - check-in
        - class
      summary: to fetch a captcha image
      operationId: check-in-fetch
      parameters:
        - in: query
          name: session_id
          required: true
          type: string
        - in: path
          name: class_id
          required: true
          type: integer
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/check-in-code'

  /check-in/code/{code_id}/start:
    post:
      tags:
        - check-in
        - class
      summary: to start a check-in code immediately
      operationId: check-in-start
      parameters:
        - in: query
          name: session_id
          required: true
          type: string
        - in: path
          name: code_id
          required: true
          type: integer
      responses:
        '200':
          description: OK

  /class/{class_id}/code/{code_id}/list:
    get:
      tags:
        - check-in
        - class
      summary: to fetch the list of checked-in users
      operationId: check-in-list
      parameters:
        - in: query
          name: session_id
          required: true
          type: string
        - in: path
          name: class_id
          required: true
          type: integer
        - in: path
          name: code_id
          required: true
          type: integer
      responses:
        '200':
          description: OK


definitions:
  user-register:
    type: object
    properties:
      # code:
      #   type: string
      #   example: <the code returned from wx.login>
      user_id:
        type: integer
        example: 12345678
      password:
        type: string
        example: p@ssword

  user-backend:
    type: object
    properties:
      user_id:
        type: integer
        example: 12345678
      password:
        type: string
        example: p@ssword


  user-show:
    type: object
    properties:
      user_id:
        type: integer
        example: 12345678

  class:
    type: object
    properties:
      class_id:
        type: integer
        example: 12345
      class_name:
        type: string
        example: Example-Class
      weekday:
        type: integer
        format: int16
        example: 1
      start:
        type: integer
        format: int16
        example: 3
      end:
        type: integer
        format: int16
        example: 5
      teacher_id:
        type: integer
        example: 12345678
      course_id:
        type: integer
        example: 12345678

  course:
    type: object
    properties:
      course_id:
        type: integer
        example: 12345
      course_name:
        type: string
        example: Example-Course
      start:
        type: string
        format: date
        example: "2019-01-02"
      end:
        type: string
        format: date
        example: "2019-03-04"

  score:
    type: object
    properties:
      score_id:
        type: integer
      score:
        type: integer
        format: int16
      user_id:
        type: integer
        format: int
      class_id:
        type: integer
        format: int

  score-add:
    type: object
    properties:
      score:
        type: integer
        format: int16
      user_id:
        type: integer
        format: int
      class_id:
        type: integer
        format: int

  score-add-specific-class:
    type: object
    properties:
      score:
        type: integer
        format: int16
      user_id:
        type: integer
        format: int

  check-in-code:
    type: object
    properties:
      code_id:
        type: integer
      code:
        type: string

  check-in-code-backend:
    type: object
    properties:
      code_id:
        type: integer
      code:
        type: string
      class_id:
        type: integer
      started:
        type: boolean
      expire_at:
        type: string
        format: time
        example: "1551682932"
